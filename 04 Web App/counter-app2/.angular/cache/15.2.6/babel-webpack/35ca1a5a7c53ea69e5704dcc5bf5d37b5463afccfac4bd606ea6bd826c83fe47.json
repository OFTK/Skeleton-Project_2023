{"ast":null,"code":"import * as signalR from \"@aspnet/signalr\";\nimport { HttpClient, HttpHeaders } from \"@angular/common/http\";\nimport { map } from \"rxjs/operators\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nvar AppComponent = /** @class */function () {\n  function AppComponent(http) {\n    var _this = this;\n    this.http = http;\n    this.httpOptions = {\n      headers: new HttpHeaders({\n        \"Content-Type\": \"application/json\",\n        \"Access-Control-Allow-Origin\": \"*\",\n        \"Access-Control-Allow-Methods\": \"POST, GET\",\n        \"Access-Control-Allow-Headers\": \"Content-Type\"\n      })\n    };\n    this.negotiateUrl = \"https://skeletonfunctionapp.azurewebsites.net/api/negotiate\";\n    this.getCounterUrl = \"https://skeletonfunctionapp.azurewebsites.net/api/getcounter\";\n    this.updateCounterUrl = \"https://skeletonfunctionapp.azurewebsites.net/api/updatecounter\";\n    // private readonly negotiateUrl = \"http://localhost:7071/api/negotiate\";\n    // private readonly getCounterUrl = \"http://localhost:7071/api/getcounter\";\n    // private readonly updateCounterUrl = \"http://localhost:7071/api/updatecounter\";\n    this.counterId = 1;\n    this.counter = 0;\n    var negotiateBody = {\n      UserId: \"SomeUser\"\n    };\n    this.http.post(this.negotiateUrl, JSON.stringify(negotiateBody), this.httpOptions).pipe(map(function (connectionDetails) {\n      return new signalR.HubConnectionBuilder().withUrl(\"\".concat(connectionDetails.url), {\n        accessTokenFactory: function () {\n          return connectionDetails.accessToken;\n        }\n      }).build();\n    })).subscribe(function (hub) {\n      _this.hubConnection = hub;\n      hub.on(\"CounterUpdate\", function (data) {\n        console.log(data);\n        _this.counter = data.Count;\n      });\n      hub.start();\n    });\n    this.http.get(this.getCounterUrl).subscribe(function (cloudCounter) {\n      console.log(cloudCounter);\n      _this.counter = +cloudCounter.count;\n    });\n  }\n  AppComponent.prototype.increaseCounter = function () {\n    var body = {\n      Id: this.counterId,\n      counter: this.counter += 1\n    };\n    this.http.post(this.updateCounterUrl, body, this.httpOptions).toPromise().catch(function (e) {\n      return console.log(e);\n    });\n  };\n  AppComponent.ɵfac = function AppComponent_Factory(t) {\n    return new (t || AppComponent)(i0.ɵɵdirectiveInject(i1.HttpClient));\n  };\n  AppComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AppComponent,\n    selectors: [[\"app-root\"]],\n    decls: 12,\n    vars: 1,\n    consts: [[2, \"text-align\", \"center\"], [3, \"click\"]],\n    template: function AppComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"h1\");\n        i0.ɵɵtext(2, \"Counter Manager App\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(3, \"h2\");\n        i0.ɵɵtext(4, \"Current Counter\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(5, \"h3\");\n        i0.ɵɵtext(6);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(7, \"br\");\n        i0.ɵɵelementStart(8, \"button\", 1);\n        i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_8_listener() {\n          return ctx.increaseCounter();\n        });\n        i0.ɵɵtext(9, \"+\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(10, \"button\", 1);\n        i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_10_listener() {\n          return ctx.increaseCounter();\n        });\n        i0.ɵɵtext(11, \"+\");\n        i0.ɵɵelementEnd()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(6);\n        i0.ɵɵtextInterpolate(ctx.counter);\n      }\n    },\n    styles: [\"\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsInNvdXJjZVJvb3QiOiIifQ== */\"]\n  });\n  return AppComponent;\n}();\nexport { AppComponent };","map":{"version":3,"mappings":"AACA,OAAO,KAAKA,OAAO,MAAM,iBAAiB;AAC1C,SAASC,UAAU,EAAEC,WAAW,QAAQ,sBAAsB;AAC9D,SAASC,GAAG,QAAmB,gBAAgB;;;AAY/C;EAwBE,sBAA6BC,IAAgB;IAA7C;IAA6B,SAAI,GAAJA,IAAI;IAlBhB,gBAAW,GAAG;MAAEC,OAAO,EAAE,IAAIH,WAAW,CAAC;QACvD,cAAc,EAAE,kBAAkB;QAClC,6BAA6B,EAAE,GAAG;QAClC,8BAA8B,EAAE,WAAW;QAC3C,8BAA8B,EAAE;OAChC;IAAC,CAAE;IACW,iBAAY,GAAG,6DAA6D;IAC5E,kBAAa,GAAG,8DAA8D;IAC9E,qBAAgB,GAAG,iEAAiE;IACrG;IACA;IACA;IAEiB,cAAS,GAAG,CAAC;IAGtB,YAAO,GAAW,CAAC;IAGzB,IAAMI,aAAa,GAAG;MAAEC,MAAM,EAAE;IAAU,CAAE;IAE5C,IAAI,CAACH,IAAI,CACNI,IAAI,CAAoB,IAAI,CAACC,YAAY,EAAEC,IAAI,CAACC,SAAS,CAACL,aAAa,CAAC,EAAE,IAAI,CAACM,WAAW,CAAC,CAC3FC,IAAI,CACHV,GAAG,CAAC,2BAAiB;MACnB,WAAIH,OAAO,CAACc,oBAAoB,EAAE,CAACC,OAAO,CAAC,UAAGC,iBAAiB,CAACC,GAAG,CAAE,EAAE;QAAEC,kBAAkB,EAAE;UAAM,wBAAiB,CAACC,WAAW;QAA7B;MAA6B,CAAE,CAAC,CAACC,KAAK,EAAE;IAA3I,CAA2I,CAC5I,CACF,CACAC,SAAS,CAAC,aAAG;MACZC,KAAI,CAACC,aAAa,GAAGC,GAAG;MACxBA,GAAG,CAACC,EAAE,CAAC,eAAe,EAAE,cAAI;QAC1BC,OAAO,CAACC,GAAG,CAACC,IAAI,CAAC;QACjBN,KAAI,CAACO,OAAO,GAAGD,IAAI,CAACE,KAAK;MAC3B,CAAC,CAAC;MACFN,GAAG,CAACO,KAAK,EAAE;IACb,CAAC,CAAC;IAEJ,IAAI,CAAC3B,IAAI,CAAC4B,GAAG,CAAU,IAAI,CAACC,aAAa,CAAC,CAACZ,SAAS,CAAC,sBAAY;MAC/DK,OAAO,CAACC,GAAG,CAACO,YAAY,CAAC;MACzBZ,KAAI,CAACO,OAAO,GAAG,CAACK,YAAY,CAACC,KAAK;IACpC,CAAC,CAAC;EACJ;EAEOC,sCAAe,GAAtB;IACE,IAAMC,IAAI,GAAG;MAAEC,EAAE,EAAE,IAAI,CAACC,SAAS;MAAEV,OAAO,EAAE,IAAI,CAACA,OAAO,IAAG;IAAC,CAAE;IAE9D,IAAI,CAACzB,IAAI,CACNI,IAAI,CAAC,IAAI,CAACgC,gBAAgB,EAAEH,IAAI,EAAE,IAAI,CAACzB,WAAW,CAAC,CACnD6B,SAAS,EAAE,CACXC,KAAK,CAAC,WAAC;MAAI,cAAO,CAACf,GAAG,CAACgB,CAAC,CAAC;IAAd,CAAc,CAAC;EAC/B,CAAC;;qBAnDUP,YAAY;EAAA;;UAAZA,YAAY;IAAAQ;IAAAC;IAAAC;IAAAC;IAAAC;MAAA;QCnBzBC,8BAA+B;QACzBA,mCAAmB;QAAAA,iBAAK;QAC5BA,0BAAI;QAAAA,+BAAe;QAAAA,iBAAK;QACxBA,0BAAI;QAAAA,YAAa;QAAAA,iBAAK;QACtBA,qBAAM;QACNA,iCAAoC;QAA5BA;UAAA,OAASC,qBAAiB;QAAA,EAAC;QAACD,iBAAC;QAAAA,iBAAS;QAC9CA,kCAAoC;QAA5BA;UAAA,OAASC,qBAAiB;QAAA,EAAC;QAACD,kBAAC;QAAAA,iBAAS;;;QAH1CA,eAAa;QAAbA,iCAAa;;;;;qBDJnB;CAwEC,EAzDD;SAKab,YAAY","names":["signalR","HttpClient","HttpHeaders","map","http","headers","negotiateBody","UserId","post","negotiateUrl","JSON","stringify","httpOptions","pipe","HubConnectionBuilder","withUrl","connectionDetails","url","accessTokenFactory","accessToken","build","subscribe","_this","hubConnection","hub","on","console","log","data","counter","Count","start","get","getCounterUrl","cloudCounter","count","AppComponent","body","Id","counterId","updateCounterUrl","toPromise","catch","e","selectors","decls","vars","consts","template","i0","ctx"],"sourceRoot":"","sources":["C:\\Users\\USER\\OneDrive - mail.tau.ac.il\\שנה ג'\\IOT workshop\\Skeleton-Project_2023\\04 Web App\\counter-app\\src\\app\\app.component.ts","C:\\Users\\USER\\OneDrive - mail.tau.ac.il\\שנה ג'\\IOT workshop\\Skeleton-Project_2023\\04 Web App\\counter-app\\src\\app\\app.component.html"],"sourcesContent":["import { Component } from \"@angular/core\";\r\nimport * as signalR from \"@aspnet/signalr\";\r\nimport { HttpClient, HttpHeaders } from \"@angular/common/http\";\r\nimport { map, switchMap } from \"rxjs/operators\";\r\n\r\ninterface SignalRConnection {\r\n  url: string;\r\n  accessToken: string;\r\n}\r\n\r\ninterface Counter {\r\n  id: number;\r\n  count: number;\r\n}\r\n\r\n@Component({\r\n  selector: \"app-root\",\r\n  templateUrl: \"./app.component.html\",\r\n  styleUrls: [\"./app.component.less\"]\r\n})\r\nexport class AppComponent {\r\n  private readonly httpOptions = { headers: new HttpHeaders({\r\n     \"Content-Type\": \"application/json\" ,\r\n     \"Access-Control-Allow-Origin\": \"*\",\r\n     \"Access-Control-Allow-Methods\": \"POST, GET\",\r\n     \"Access-Control-Allow-Headers\": \"Content-Type\"\r\n    }) };\r\n  private readonly negotiateUrl = \"https://skeletonfunctionapp.azurewebsites.net/api/negotiate\";\r\n  private readonly getCounterUrl = \"https://skeletonfunctionapp.azurewebsites.net/api/getcounter\";\r\n  private readonly updateCounterUrl = \"https://skeletonfunctionapp.azurewebsites.net/api/updatecounter\";\r\n  // private readonly negotiateUrl = \"http://localhost:7071/api/negotiate\";\r\n  // private readonly getCounterUrl = \"http://localhost:7071/api/getcounter\";\r\n  // private readonly updateCounterUrl = \"http://localhost:7071/api/updatecounter\";\r\n\r\n  private readonly counterId = 1;\r\n\r\n  private hubConnection: signalR.HubConnection;\r\n  private counter: number = 0;\r\n\r\n  constructor(private readonly http: HttpClient) {\r\n    const negotiateBody = { UserId: \"SomeUser\" };\r\n\r\n    this.http\r\n      .post<SignalRConnection>(this.negotiateUrl, JSON.stringify(negotiateBody), this.httpOptions)\r\n      .pipe(\r\n        map(connectionDetails =>\r\n          new signalR.HubConnectionBuilder().withUrl(`${connectionDetails.url}`, { accessTokenFactory: () => connectionDetails.accessToken }).build()\r\n        )\r\n      )\r\n      .subscribe(hub => {\r\n        this.hubConnection = hub;\r\n        hub.on(\"CounterUpdate\", data => {\r\n          console.log(data);\r\n          this.counter = data.Count;\r\n        });\r\n        hub.start();\r\n      });\r\n\r\n    this.http.get<Counter>(this.getCounterUrl).subscribe(cloudCounter => {\r\n      console.log(cloudCounter);\r\n      this.counter = +cloudCounter.count;\r\n    });\r\n  }\r\n\r\n  public increaseCounter(): void {\r\n    const body = { Id: this.counterId, counter: this.counter +=1 };\r\n\r\n    this.http\r\n      .post(this.updateCounterUrl, body, this.httpOptions)\r\n      .toPromise()\r\n      .catch(e => console.log(e));\r\n  }\r\n}\r\n","<!--The content below is only a placeholder and can be replaced.-->\r\n<div style=\"text-align:center\">\r\n  <h1>Counter Manager App</h1>\r\n  <h2>Current Counter</h2>\r\n  <h3>{{ counter }}</h3>\r\n  <br />\r\n  <button (click)=\"increaseCounter()\">+</button>\r\n  <button (click)=\"increaseCounter()\">+</button>\r\n</div>\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}